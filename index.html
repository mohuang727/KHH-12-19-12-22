<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜é›„å¾®é†ºä¹‹æ—…</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Phosphor Icons (åœ–ç¤ºåº«) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        body { font-family: system-ui, -apple-system, sans-serif; background-color: #f8fafc; }
        /* Modal å‹•ç•« */
        .modal { transition: opacity 0.25s ease; }
        body.modal-active { overflow-x: hidden; overflow-y: hidden !important; }
    </style>
</head>
<body class="text-slate-800">

    <div class="max-w-md mx-auto bg-slate-50 min-h-screen shadow-xl border-x border-slate-200 pb-24 relative">
        
        <!-- Header -->
        <div class="bg-white sticky top-0 z-20 border-b border-slate-200 shadow-sm">
            <div class="p-4 bg-indigo-600 text-white flex justify-between items-center">
                <div>
                    <h1 class="text-xl font-bold flex items-center gap-2">
                        <i class="ph-fill ph-navigation-arrow text-2xl"></i>
                        é«˜é›„å¾®é†ºè½åœ˜ä¹‹æ—…
                    </h1>
                    <p class="text-indigo-200 text-sm mt-1">12/19 - 12/22 è¡Œç¨‹è¡¨</p>
                </div>
                <!-- Reset Button (æ¸…é™¤æ‰€æœ‰æ–°å¢çš„è³‡æ–™) -->
                <button onclick="clearCustomData()" class="text-indigo-300 hover:text-white text-xs underline">é‡ç½®è¡Œç¨‹</button>
            </div>
            
            <!-- Date Tabs -->
            <div id="date-tabs" class="flex overflow-x-auto no-scrollbar"></div>
        </div>

        <!-- Content Area -->
        <div class="p-4">
            
            <!-- Day 2 Toggle -->
            <div id="day2-toggle" class="hidden mb-6 bg-white p-1 rounded-xl shadow-sm border border-slate-200 flex">
                <button onclick="setDay2Plan('A')" id="btn-plan-a" class="flex-1 py-2 px-3 rounded-lg text-sm font-bold transition-all">
                    æ–¹æ¡ˆ A: æ——æ´¥/é§äºŒ
                </button>
                <button onclick="setDay2Plan('B')" id="btn-plan-b" class="flex-1 py-2 px-3 rounded-lg text-sm font-bold transition-all">
                    æ–¹æ¡ˆ B: å‹•ç‰©åœ’/é«˜æµ
                </button>
            </div>

            <!-- Timeline Container -->
            <div class="space-y-4 relative">
                <div class="absolute left-4 top-2 bottom-4 w-0.5 bg-slate-200 z-0"></div>
                <div id="timeline-list"></div>
            </div>

            <!-- Footer Message -->
            <div class="mt-8 text-center pb-8">
                <div class="inline-block p-3 rounded-full bg-slate-100 text-slate-400">
                    <i class="ph-fill ph-moon text-2xl"></i>
                </div>
                <p id="footer-msg" class="text-slate-400 text-sm mt-2">ä»Šå¤©çš„è¡Œç¨‹çµæŸäº†ï¼Œæ™šå®‰ï¼</p>
            </div>
        </div>

        <!-- Floating Action Button (Add) -->
        <button onclick="openModal()" class="fixed bottom-6 right-6 md:right-[calc(50%-200px)] w-14 h-14 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full shadow-lg flex items-center justify-center transition-transform hover:scale-105 z-30">
            <i class="ph-bold ph-plus text-2xl"></i>
        </button>
    </div>

    <!-- Modal for Adding Item -->
    <div id="add-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50" onclick="closeModal()"></div>
        
        <div class="modal-container bg-white w-11/12 max-w-sm mx-auto rounded-xl shadow-2xl z-50 overflow-y-auto transform transition-all scale-95 opacity-0 duration-300" id="modal-content">
            <div class="p-4 border-b border-slate-100 flex justify-between items-center">
                <h3 class="font-bold text-lg text-slate-700">æ–°å¢è¡Œç¨‹</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600">
                    <i class="ph-bold ph-x text-lg"></i>
                </button>
            </div>

            <div class="p-4 space-y-4">
                <div class="grid grid-cols-2 gap-4">
                     <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">æ—¥æœŸ</label>
                        <select id="input-date" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:outline-none focus:border-indigo-500">
                            <option value="12/19">12/19 (äº”)</option>
                            <option value="12/20">12/20 (å…­)</option>
                            <option value="12/21">12/21 (æ—¥)</option>
                            <option value="12/22">12/22 (ä¸€)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">æ™‚é–“</label>
                        <input type="time" id="input-time" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:outline-none focus:border-indigo-500">
                    </div>
                </div>
               
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">æ¨™é¡Œ</label>
                    <input type="text" id="input-title" placeholder="ä¾‹å¦‚ï¼šè²·é£²æ–™" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:outline-none focus:border-indigo-500">
                </div>
                
                <!-- Location with GPS Button -->
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">åœ°é» / å®šä½</label>
                    <div class="flex gap-2">
                        <input type="text" id="input-location" placeholder="è¼¸å…¥åœ°é»æˆ–é»æ“Šå®šä½" class="flex-1 bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:outline-none focus:border-indigo-500">
                        <button onclick="getCurrentLocation()" class="bg-indigo-100 text-indigo-600 px-3 rounded-lg hover:bg-indigo-200 transition-colors flex items-center justify-center" title="å–å¾—ç›®å‰ä½ç½®">
                            <i class="ph-fill ph-crosshair text-lg"></i>
                        </button>
                    </div>
                    <p class="text-[10px] text-slate-400 mt-1">* é»æ“Šå³å´æŒ‰éˆ•å¯è‡ªå‹•å¡«å…¥ç•¶å‰ç¶“ç·¯åº¦</p>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">å‚™è¨» (é¸å¡«)</label>
                    <input type="text" id="input-note" placeholder="å‚™è¨»äº‹é …" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-slate-700 focus:outline-none focus:border-indigo-500">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">é¡å‹</label>
                    <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1" id="type-selector">
                        <button onclick="selectType(this, 'food')" class="type-btn flex-shrink-0 px-3 py-1 rounded-full text-xs font-bold bg-white text-slate-500 border border-slate-200 transition-all" data-type="food">é£Ÿç‰©</button>
                        <button onclick="selectType(this, 'travel')" class="type-btn flex-shrink-0 px-3 py-1 rounded-full text-xs font-bold bg-white text-slate-500 border border-slate-200 transition-all" data-type="travel">æ™¯é»</button>
                        <button onclick="selectType(this, 'art')" class="type-btn flex-shrink-0 px-3 py-1 rounded-full text-xs font-bold bg-white text-slate-500 border border-slate-200 transition-all" data-type="art">è—æ–‡</button>
                        <button onclick="selectType(this, 'bar')" class="type-btn flex-shrink-0 px-3 py-1 rounded-full text-xs font-bold bg-white text-slate-500 border border-slate-200 transition-all" data-type="bar">é…’å§</button>
                    </div>
                </div>
            </div>

            <div class="p-4 bg-slate-50 rounded-b-xl flex justify-end gap-2">
                <button onclick="closeModal()" class="px-4 py-2 text-sm text-slate-500 font-medium hover:text-slate-700">å–æ¶ˆ</button>
                <button onclick="saveNewItem()" class="px-4 py-2 text-sm bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 shadow-md">å„²å­˜è¡Œç¨‹</button>
            </div>
        </div>
    </div>

    <script>
        // --- Default Data ---
        const defaultSchedule = {
            '12/19': [
                { id: '1-1', time: '14:00', title: 'æŠµé”é«˜é›„', location: 'å·¦ç‡Ÿ/é«˜é›„è»Šç«™', type: 'travel', icon: 'ph-train', note: 'å‰å¾€èœœæ¡ƒå®¶æ”¾è¡Œæ' },
                { id: '1-2', time: '16:00', title: 'å…§æƒŸè—è¡“ä¸­å¿ƒ', location: 'é¼“å±±å€é¦¬å¡é“è·¯329è™Ÿ', type: 'art', icon: 'ph-camera', note: 'ç´”ç™½å»ºç¯‰å¥½æ‹ï¼Œå¯é€›å±•æˆ–çœ‹é›»å½±' },
                { id: '1-3', time: '18:00', title: 'DDC é¤é…’é¤¨', location: 'é¼“å±±å€æ˜Œç››è·¯302è™Ÿ', type: 'food', icon: 'ph-fork-knife', note: 'ğŸ”¥ å»ºè­°æå‰è¨‚ä½', highlight: true },
                { id: '1-4', time: '20:00', title: 'å—å–ƒ Nan Nan å·¥ä½œ', location: 'æ–°èˆˆå€å—è¯è·¯101è™Ÿ', type: 'work', icon: 'ph-briefcase', note: 'å·¥ä½œå…©å°æ™‚ï¼Œè™•ç†å…¬å‹™' },
                { id: '1-5', time: '22:30', title: 'å…­åˆå¤œå¸‚', location: 'å…­åˆäºŒè·¯', type: 'food', icon: 'ph-moon', note: 'å·¥ä½œå¾Œè£œå……èƒ½é‡' },
                { id: '1-6', time: '23:30', title: 'æµªéš› WAVESTELLAR', location: 'å¤§æ¸¯å€‰ä¸ƒåº«', type: 'bar', icon: 'ph-music-notes', note: 'æ¸¯é‚Šå¤œæ™¯èª¿é…’ï¼Œäº«å—æ°›åœ' },
                { id: '1-7', time: 'æ·±å¤œ', title: 'å›èœœæ¡ƒå®¶', location: 'èœœæ¡ƒå®¶', type: 'sleep', icon: 'ph-moon' },
            ],
            '12/20': {
                options: {
                    'A': [
                        { id: '2A-1', time: '13:00', title: 'æ——æ´¥æ¼«éŠ', location: 'æ——æ´¥', type: 'travel', icon: 'ph-sun', note: 'æ­æ¸¡è¼ªã€çœ‹æµ·ã€åƒæµ·é®®' },
                        { id: '2A-2', time: '15:00', title: 'é¹½åŸ•ç¬¬ä¸€å…¬æœ‰å¸‚å ´', location: 'é¹½åŸ•å€', type: 'food', icon: 'ph-fork-knife', note: 'æ–‡é’å°åº—ã€ç”œé»' },
                        { id: '2A-3', time: '16:30', title: 'é§äºŒè—è¡“ç‰¹å€', location: 'é§äºŒ', type: 'art', icon: 'ph-camera', note: 'é€›å¤§ç¾©å€‰åº«ç¾¤' },
                    ],
                    'B': [
                        { id: '2B-1', time: '13:00', title: 'å£½å±±å‹•ç‰©åœ’', location: 'å£½å±±', type: 'travel', icon: 'ph-sun', note: 'çœ‹æ°´è±šã€æ­éŠåœ’å°ç«è»Š' },
                        { id: '2B-2', time: '16:00', title: 'é«˜é›„æµè¡ŒéŸ³æ¨‚ä¸­å¿ƒ', location: 'çœŸæ„›ç¢¼é ­', type: 'art', icon: 'ph-camera', note: 'æµ·éŸ³é¤¨å»ºç¯‰ã€æ¸¯ç£æ•£æ­¥' },
                    ]
                },
                evening: [
                    { id: '2-4', time: '18:00', title: 'è‡ªå¼·å¤œå¸‚æ™šé¤', location: 'è‹“é›…å¸‚å ´/è‡ªå¼·å¤œå¸‚', type: 'food', icon: 'ph-fork-knife', note: 'åœ¨åœ°ç¾é£Ÿå¤šï¼šå—è±é­¯è‚‰é£¯ã€æ°´é¤ƒ' },
                    { id: '2-5', time: '19:30', title: 'ä¸­å¤®å…¬åœ’è½åœ˜', location: 'ä¸­å¤®å…¬åœ’', type: 'music', icon: 'ph-music-notes', note: 'ğŸ„ 2025é«˜é›„è–èª•ç”Ÿæ´»ç¯€', highlight: true },
                    { id: '2-6', time: '22:00', title: 'OFFLINE å–é…’', location: 'æ–°èˆˆå€ç‰ç«¹äºŒè¡—44è™Ÿ', type: 'bar', icon: 'ph-music-notes', note: 'èŒ¶é…’é¤¨ï¼Œæ°£æ°›ä½³' },
                    { id: '2-7', time: 'æ·±å¤œ', title: 'å›èœœæ¡ƒå®¶', location: 'èœœæ¡ƒå®¶', type: 'sleep', icon: 'ph-moon' },
                ]
            },
            '12/21': [
                { id: '3-1', time: '09:00', title: 'æ—©é¤ï¼šèˆˆéš†å±…', location: 'å‰é‡‘å€å…­åˆäºŒè·¯186è™Ÿ', type: 'food', icon: 'ph-fork-knife', note: 'å¿…é»æ¹¯åŒ…ã€ç‡’é¤…æ²¹æ¢' },
                { id: '3-2', time: '11:00', title: 'è‡ªç”±æ´»å‹• / ä¼‘æ¯', location: '-', type: 'rest', icon: 'ph-sun', note: 'å»ºè­°å›é£¯åº—ä¼‘æ¯æˆ–æ‰¾å’–å•¡å»³ï¼Œç‚ºæ™šä¸Šè“„åŠ›' },
                { id: '3-3', time: '19:00', title: 'Doja Cat æ¼”å”±æœƒ', location: 'é«˜é›„å·¨è›‹', type: 'music', icon: 'ph-music-notes', note: 'ğŸ¤ è¨˜å¾—ææ—©å…¥å ´å®‰æª¢', highlight: true },
                { id: '3-4', time: '22:30', title: 'ç‘è±å¤œå¸‚', location: 'è£•èª è·¯/å—å±è·¯', type: 'food', icon: 'ph-moon', note: 'æ¼”å”±æœƒæ•£å ´è¦“é£Ÿ' },
                { id: '3-5', time: 'æ·±å¤œ', title: 'å›æ—…é¤¨ä¼‘æ¯', location: 'æ—…é¤¨', type: 'sleep', icon: 'ph-moon' },
            ],
            '12/22': [
                { id: '4-1', time: '10:00', title: 'å“†å•¦Aå¤¢å±•', location: 'åœ‹ç«‹ç§‘å­¸å·¥è—åšç‰©é¤¨', type: 'art', icon: 'ph-camera', note: 'THE å“†å•¦Aå¤¢å±•ï¼Œé ç•™2-3å°æ™‚', highlight: true },
                { id: '4-2', time: '14:00', title: 'å·¦ç‡Ÿé¾è™å¡”', location: 'è“®æ± æ½­', type: 'travel', icon: 'ph-sun', note: 'é¾å£é€²è™å£å‡ºï¼Œæ¶ˆç½è§£å„' },
                { id: '4-3', time: '16:30', title: 'å‰å¾€è»Šç«™', location: 'å·¦ç‡Ÿé«˜éµ', type: 'travel', icon: 'ph-train', note: 'æº–å‚™è¿”ç¨‹' },
                { id: '4-4', time: '17:00', title: 'å›å°åŒ—', location: 'å°åŒ—', type: 'travel', icon: 'ph-train', note: 'å¹³å®‰è³¦æ­¸' },
            ]
        };

        // --- State Management ---
        let activeTab = '12/19';
        let day2Plan = 'A'; // 'A' or 'B'
        let completedItems = new Set(JSON.parse(localStorage.getItem('kaohsiungTripCompleted') || '[]'));
        let customItems = JSON.parse(localStorage.getItem('kaohsiungTripCustomItems') || '{}');
        let selectedType = 'food'; // for modal

        // --- Render Functions ---

        function renderTabs() {
            const tabsContainer = document.getElementById('date-tabs');
            tabsContainer.innerHTML = '';
            
            Object.keys(defaultSchedule).forEach(date => {
                const btn = document.createElement('button');
                const isActive = activeTab === date;
                btn.className = `flex-1 py-3 px-4 text-sm font-medium whitespace-nowrap border-b-2 transition-colors duration-200 ${
                    isActive 
                    ? 'border-indigo-600 text-indigo-600 bg-indigo-50' 
                    : 'border-transparent text-slate-500 hover:text-slate-700 hover:bg-slate-50'
                }`;
                btn.innerText = date;
                btn.onclick = () => {
                    activeTab = date;
                    renderApp();
                };
                tabsContainer.appendChild(btn);
            });
        }

        function renderDay2Toggle() {
            const toggleContainer = document.getElementById('day2-toggle');
            const btnA = document.getElementById('btn-plan-a');
            const btnB = document.getElementById('btn-plan-b');

            if (activeTab === '12/20') {
                toggleContainer.classList.remove('hidden');
                if (day2Plan === 'A') {
                    btnA.className = 'flex-1 py-2 px-3 rounded-lg text-sm font-bold transition-all bg-indigo-100 text-indigo-700 shadow-sm';
                    btnB.className = 'flex-1 py-2 px-3 rounded-lg text-sm font-bold transition-all text-slate-400 hover:text-slate-600';
                } else {
                    btnA.className = 'flex-1 py-2 px-3 rounded-lg text-sm font-bold transition-all text-slate-400 hover:text-slate-600';
                    btnB.className = 'flex-1 py-2 px-3 rounded-lg text-sm font-bold transition-all bg-teal-100 text-teal-700 shadow-sm';
                }
            } else {
                toggleContainer.classList.add('hidden');
            }
        }

        function getDayList() {
            // Merge default schedule with custom items for the active day
            let currentDayItems = [];
            
            if (activeTab === '12/20') {
                currentDayItems = [...defaultSchedule['12/20'].options[day2Plan], ...defaultSchedule['12/20'].evening];
            } else {
                currentDayItems = [...defaultSchedule[activeTab]];
            }

            // Add custom items if they exist for this day
            if (customItems[activeTab]) {
                currentDayItems = [...currentDayItems, ...customItems[activeTab]];
            }

            // Sort by time
            return currentDayItems.sort((a, b) => a.time.localeCompare(b.time));
        }

        function getTypeColor(type) {
            switch (type) {
                case 'food': return 'bg-orange-100 text-orange-600 border-orange-200';
                case 'music': return 'bg-purple-100 text-purple-600 border-purple-200';
                case 'art': return 'bg-teal-100 text-teal-600 border-teal-200';
                case 'bar': return 'bg-indigo-900 text-indigo-300 border-indigo-700';
                case 'work': return 'bg-gray-800 text-gray-200 border-gray-600';
                case 'travel': return 'bg-blue-100 text-blue-600 border-blue-200';
                case 'sleep': return 'bg-slate-100 text-slate-500 border-slate-200';
                default: return 'bg-gray-100 text-gray-600';
            }
        }

        function getTypeIcon(type) {
             switch (type) {
                case 'food': return 'ph-fork-knife';
                case 'music': return 'ph-music-notes';
                case 'art': return 'ph-camera';
                case 'bar': return 'ph-martini';
                case 'work': return 'ph-briefcase';
                case 'travel': return 'ph-train';
                case 'sleep': return 'ph-moon';
                default: return 'ph-circle';
            }
        }

        function toggleComplete(id) {
            if (completedItems.has(id)) {
                completedItems.delete(id);
            } else {
                completedItems.add(id);
            }
            localStorage.setItem('kaohsiungTripCompleted', JSON.stringify([...completedItems]));
            renderTimeline();
        }

        function openMap(location) {
            window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location + ' é«˜é›„')}`, '_blank');
        }

        function setDay2Plan(plan) {
            day2Plan = plan;
            renderApp();
        }

        // --- Add Item Logic ---
        function openModal() {
            const modal = document.getElementById('add-modal');
            const content = document.getElementById('modal-content');
            document.getElementById('input-date').value = activeTab; // Set default date to current tab
            
            modal.classList.remove('pointer-events-none', 'opacity-0');
            setTimeout(() => {
                content.classList.remove('scale-95', 'opacity-0');
                content.classList.add('scale-100', 'opacity-100');
            }, 10);
            
            // Default type selection
            selectType(document.querySelector('[data-type="food"]'), 'food');
        }

        function closeModal() {
            const modal = document.getElementById('add-modal');
            const content = document.getElementById('modal-content');
            
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                modal.classList.add('pointer-events-none', 'opacity-0');
            }, 300);
            
            // Clear inputs
            document.getElementById('input-title').value = '';
            document.getElementById('input-location').value = '';
            document.getElementById('input-note').value = '';
            document.getElementById('input-time').value = '';
        }

        function selectType(btn, type) {
            selectedType = type;
            // Reset all buttons
            document.querySelectorAll('#type-selector .type-btn').forEach(b => {
                b.className = 'type-btn flex-shrink-0 px-3 py-1 rounded-full text-xs font-bold bg-white text-slate-500 border border-slate-200 transition-all';
            });
            // Highlight selected
            let colorClass = '';
            if(type === 'food') colorClass = 'bg-orange-100 text-orange-600 border-orange-200 ring-1 ring-orange-300';
            else if(type === 'travel') colorClass = 'bg-blue-100 text-blue-600 border-blue-200 ring-1 ring-blue-300';
            else if(type === 'art') colorClass = 'bg-teal-100 text-teal-600 border-teal-200 ring-1 ring-teal-300';
            else if(type === 'bar') colorClass = 'bg-indigo-100 text-indigo-600 border-indigo-200 ring-1 ring-indigo-300';
            
            btn.className = `type-btn flex-shrink-0 px-3 py-1 rounded-full text-xs font-bold transition-all ${colorClass}`;
        }

        function getCurrentLocation() {
            const btn = document.querySelector('button[onclick="getCurrentLocation()"]');
            const icon = btn.querySelector('i');
            const originalIconClass = icon.className;
            
            if (!navigator.geolocation) {
                alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å®šä½åŠŸèƒ½');
                return;
            }

            // Loading state
            icon.className = 'ph ph-spinner animate-spin text-lg';
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;
                    // Format to 6 decimal places for precision but cleaner look
                    const lat = latitude.toFixed(6);
                    const lng = longitude.toFixed(6);
                    document.getElementById('input-location').value = `${lat}, ${lng}`;
                    icon.className = 'ph-fill ph-check text-lg text-green-600';
                    setTimeout(() => icon.className = originalIconClass, 2000);
                },
                (error) => {
                    console.error(error);
                    alert('ç„¡æ³•å–å¾—ä½ç½®ã€‚è«‹ç¢ºèªæ‚¨å·²å…è¨±ç€è¦½å™¨å­˜å–ä½ç½®è³‡è¨Šã€‚');
                    icon.className = originalIconClass;
                }
            );
        }

        function saveNewItem() {
            const date = document.getElementById('input-date').value;
            const time = document.getElementById('input-time').value;
            const title = document.getElementById('input-title').value;
            const location = document.getElementById('input-location').value;
            const note = document.getElementById('input-note').value;

            if (!time || !title) {
                alert('è«‹è‡³å°‘å¡«å¯«æ™‚é–“å’Œæ¨™é¡Œï¼');
                return;
            }

            const newItem = {
                id: 'custom-' + Date.now(),
                time,
                title,
                location: location || '-',
                type: selectedType,
                icon: getTypeIcon(selectedType),
                note,
                isCustom: true
            };

            // Initialize array for this date if not exists
            if (!customItems[date]) {
                customItems[date] = [];
            }

            customItems[date].push(newItem);
            localStorage.setItem('kaohsiungTripCustomItems', JSON.stringify(customItems));
            
            closeModal();
            // Switch to the date of the new item if different
            if (activeTab !== date) {
                activeTab = date;
            }
            renderApp();
        }

        function clearCustomData() {
            if(confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ‚¨æ‰‹å‹•æ–°å¢çš„è¡Œç¨‹å—ï¼Ÿ(é è¨­è¡Œç¨‹æœƒä¿ç•™)')) {
                localStorage.removeItem('kaohsiungTripCustomItems');
                customItems = {};
                renderApp();
            }
        }

        function renderTimeline() {
            const listContainer = document.getElementById('timeline-list');
            listContainer.innerHTML = '';
            const items = getDayList();

            items.forEach(item => {
                const isCompleted = completedItems.has(item.id);
                
                // Outer Wrapper
                const wrapper = document.createElement('div');
                wrapper.className = `relative z-10 pl-10 transition-all duration-300 ${isCompleted ? 'opacity-50 grayscale' : ''}`;

                // Checkbox
                const checkBtn = document.createElement('button');
                checkBtn.className = `absolute left-0 top-1.5 w-8 h-8 rounded-full flex items-center justify-center border-2 bg-white transition-colors ${
                    isCompleted 
                    ? 'border-indigo-400 text-indigo-500' 
                    : 'border-slate-300 text-slate-300 hover:border-indigo-400 hover:text-indigo-400'
                }`;
                checkBtn.innerHTML = isCompleted ? '<i class="ph-fill ph-check-circle text-xl"></i>' : '<i class="ph ph-circle text-xl"></i>';
                checkBtn.onclick = () => toggleComplete(item.id);

                // Card
                const card = document.createElement('div');
                card.className = `bg-white rounded-xl p-4 shadow-sm border border-slate-100 hover:shadow-md transition-shadow ${item.highlight ? 'ring-2 ring-yellow-400 ring-opacity-50' : ''}`;

                // Header
                const headerDiv = document.createElement('div');
                headerDiv.className = 'flex justify-between items-start mb-2';
                
                const timeTagDiv = document.createElement('div');
                timeTagDiv.className = 'flex items-center gap-2';
                timeTagDiv.innerHTML = `<span class="px-2 py-1 rounded text-xs font-bold border ${getTypeColor(item.type)}">${item.time}</span>`;
                if (item.highlight) {
                    timeTagDiv.innerHTML += `<span class="flex items-center gap-1 text-[10px] bg-red-100 text-red-600 px-1.5 py-0.5 rounded-full font-bold">â˜… é‡é»</span>`;
                }
                if (item.isCustom) {
                     timeTagDiv.innerHTML += `<span class="flex items-center gap-1 text-[10px] bg-indigo-50 text-indigo-400 px-1.5 py-0.5 rounded-full border border-indigo-100">æ–°å¢</span>`;
                }

                const mapBtn = document.createElement('button');
                mapBtn.className = 'text-slate-400 hover:text-blue-500 transition-colors';
                mapBtn.title = 'åœ¨ Google Maps é–‹å•Ÿ';
                mapBtn.innerHTML = '<i class="ph-fill ph-navigation-arrow text-lg"></i>';
                mapBtn.onclick = () => openMap(item.location !== '-' ? item.location : item.title);

                headerDiv.appendChild(timeTagDiv);
                headerDiv.appendChild(mapBtn);

                // Title
                const title = document.createElement('h3');
                title.className = `font-bold text-lg mb-1 flex items-center gap-2 ${isCompleted ? 'line-through text-slate-400' : 'text-slate-800'}`;
                title.innerHTML = `<i class="${item.icon} opacity-70"></i> ${item.title}`;

                // Location
                let locationDiv = '';
                if (item.location && item.location !== '-') {
                    locationDiv = `<div class="flex items-center gap-1 text-slate-500 text-xs mb-2 truncate">
                        <i class="ph-fill ph-map-pin flex-shrink-0"></i> ${item.location}
                    </div>`;
                }

                // Note
                let noteDiv = '';
                if (item.note) {
                    noteDiv = `<div class="bg-slate-50 p-2 rounded-lg text-sm text-slate-600 flex gap-2 items-start mt-2">
                        <i class="ph-fill ph-info text-indigo-400 mt-0.5 flex-shrink-0"></i> ${item.note}
                    </div>`;
                }

                card.appendChild(headerDiv);
                card.appendChild(title);
                if(locationDiv) card.innerHTML += locationDiv;
                if(noteDiv) card.innerHTML += noteDiv;

                wrapper.appendChild(checkBtn);
                wrapper.appendChild(card);
                listContainer.appendChild(wrapper);
            });
        }

        // --- Init ---
        function renderApp() {
            renderTabs();
            renderDay2Toggle();
            renderTimeline();
            const footerMsg = document.getElementById('footer-msg');
            footerMsg.innerText = activeTab === '12/22' ? 'æ—…ç¨‹çµæŸï¼ŒæœŸå¾…ä¸‹æ¬¡ç›¸è¦‹ï¼' : 'ä»Šå¤©çš„è¡Œç¨‹çµæŸäº†ï¼Œæ™šå®‰ï¼';
        }

        renderApp();

    </script>
</body>
</html>
