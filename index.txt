<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜é›„å¾®é†ºè½åœ˜ä¹‹æ—…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        body { font-family: system-ui, -apple-system, sans-serif; background-color: #f1f5f9; }
        .modal { transition: opacity 0.25s ease; }
        /* å¡ç‰‡æ‡¸åœç‰¹æ•ˆ */
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="text-slate-800">

    <div class="max-w-md mx-auto bg-slate-50 min-h-screen shadow-2xl border-x border-slate-200 pb-24 relative">
        
        <!-- Header: é ‚éƒ¨å°èˆªåˆ— -->
        <div class="bg-indigo-600 sticky top-0 z-30 shadow-md">
            <div class="p-4 text-white flex justify-between items-center">
                <div>
                    <h1 class="text-xl font-bold flex items-center gap-2">
                        <i class="ph-fill ph-airplane-tilt text-2xl"></i>
                        é«˜é›„å¾®é†ºè½åœ˜
                    </h1>
                    <p class="text-indigo-200 text-xs mt-1">12/19 - 12/22 æ—…éŠæ‰‹å†Š</p>
                </div>
                <!-- æ¸…é™¤è³‡æ–™æŒ‰éˆ• -->
                <button onclick="clearCustomData()" class="text-indigo-200 hover:text-white text-xs bg-indigo-700 px-2 py-1 rounded transition-colors">
                    é‡ç½®è¡Œç¨‹
                </button>
            </div>
            
            <!-- æ—¥æœŸæ¨™ç±¤ (è‡ªå‹•ç”Ÿæˆ) -->
            <div id="date-tabs" class="flex overflow-x-auto no-scrollbar bg-white/10 backdrop-blur-md"></div>
        </div>

        <!-- ä¸»è¦å…§å®¹å€ -->
        <div class="p-4">
            
            <!-- é€±å…­æ–¹æ¡ˆåˆ‡æ›æŒ‰éˆ• (åªåœ¨ 12/20 é¡¯ç¤º) -->
            <div id="day2-toggle" class="hidden mb-6 bg-white p-1 rounded-xl shadow-sm border border-slate-200 flex transition-all">
                <button onclick="setDay2Plan('A')" id="btn-plan-a" class="flex-1 py-2 px-3 rounded-lg text-sm font-bold transition-all">
                    æ–¹æ¡ˆ A: æ——æ´¥/é§äºŒ
                </button>
                <button onclick="setDay2Plan('B')" id="btn-plan-b" class="flex-1 py-2 px-3 rounded-lg text-sm font-bold transition-all">
                    æ–¹æ¡ˆ B: å‹•ç‰©åœ’/é«˜æµ
                </button>
            </div>

            <!-- è¡Œç¨‹åˆ—è¡¨ (å¡ç‰‡å®¹å™¨) -->
            <div id="timeline-list" class="space-y-6"></div>

            <!-- åº•éƒ¨è¨Šæ¯ -->
            <div class="mt-8 text-center pb-8 opacity-60">
                <i class="ph-fill ph-moon-stars text-3xl mb-2 text-indigo-300"></i>
                <p id="footer-msg" class="text-slate-400 text-sm">ä»Šå¤©çš„è¡Œç¨‹çµæŸäº†ï¼Œæ™šå®‰ï¼</p>
            </div>
        </div>

        <!-- å³ä¸‹è§’æ‡¸æµ®æ–°å¢æŒ‰éˆ• -->
        <button onclick="openModal()" class="fixed bottom-6 right-6 md:right-[calc(50%-200px)] w-14 h-14 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full shadow-lg flex items-center justify-center transition-transform hover:scale-110 active:scale-95 z-40 ring-4 ring-indigo-200">
            <i class="ph-bold ph-plus text-2xl"></i>
        </button>
    </div>

    <!-- æ–°å¢è¡Œç¨‹è¦–çª— (Modal) -->
    <div id="add-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50 px-4">
        <!-- èƒŒæ™¯é®ç½© -->
        <div class="modal-overlay absolute w-full h-full bg-gray-900/60 backdrop-blur-sm" onclick="closeModal()"></div>
        
        <!-- è¦–çª—å…§å®¹ -->
        <div class="modal-container bg-white w-full max-w-sm mx-auto rounded-2xl shadow-2xl z-50 overflow-hidden transform transition-all scale-95 opacity-0 duration-300" id="modal-content">
            <div class="bg-indigo-600 p-4 flex justify-between items-center text-white">
                <h3 class="font-bold text-lg flex items-center gap-2"><i class="ph-bold ph-pencil-simple"></i> æ–°å¢è¡Œç¨‹</h3>
                <button onclick="closeModal()" class="hover:text-indigo-200 bg-white/20 rounded-full w-8 h-8 flex items-center justify-center"><i class="ph-bold ph-x text-lg"></i></button>
            </div>

            <div class="p-5 space-y-4 max-h-[70vh] overflow-y-auto bg-slate-50">
                <!-- æ—¥æœŸèˆ‡æ™‚é–“ -->
                <div class="grid grid-cols-2 gap-3">
                     <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">æ—¥æœŸ</label>
                        <select id="input-date" class="w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none shadow-sm">
                            <option value="12/19">12/19 (äº”)</option>
                            <option value="12/20">12/20 (å…­)</option>
                            <option value="12/21">12/21 (æ—¥)</option>
                            <option value="12/22">12/22 (ä¸€)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">æ™‚é–“</label>
                        <input type="time" id="input-time" class="w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none shadow-sm">
                    </div>
                </div>
               
                <!-- æ¨™é¡Œ -->
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">è¡Œç¨‹æ¨™é¡Œ</label>
                    <input type="text" id="input-title" placeholder="ä¾‹å¦‚ï¼šå»åƒä¸¹ä¸¹æ¼¢å ¡" class="w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none shadow-sm">
                </div>

                <!-- åœ°é»èˆ‡å®šä½ -->
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">åœ°é» / å®šä½</label>
                    <div class="flex gap-2">
                        <input type="text" id="input-location" placeholder="è¼¸å…¥åœ°é»æˆ–é»æ“Šå³å´å®šä½" class="flex-1 bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none shadow-sm">
                        <button onclick="getCurrentLocation()" class="bg-indigo-100 text-indigo-600 px-3 rounded-lg hover:bg-indigo-200 transition-colors shadow-sm active:scale-95" title="å–å¾—ç›®å‰ä½ç½®">
                            <i class="ph-fill ph-crosshair text-lg"></i>
                        </button>
                    </div>
                </div>

                <!-- åœ–ç‰‡é€£çµ -->
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">å°é¢åœ–ç‰‡ç¶²å€ (é¸å¡«)</label>
                    <input type="text" id="input-image" placeholder="è²¼ä¸Šåœ–ç‰‡ URL (ä¾‹å¦‚ https://...)" class="w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none shadow-sm text-slate-500">
                    <p class="text-[10px] text-slate-400 mt-1">è‹¥ç•™ç©ºå°‡è‡ªå‹•ç”¢ç”Ÿé è¨­åœ–</p>
                </div>

                <!-- å‚™è¨» -->
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">å‚™è¨»</label>
                    <textarea id="input-note" rows="2" placeholder="æœ‰ä»€éº¼è¦ç‰¹åˆ¥æ³¨æ„çš„..." class="w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none shadow-sm"></textarea>
                </div>
                
                <!-- é¡å‹é¸æ“‡ -->
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">é¡å‹æ¨™ç±¤</label>
                    <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1" id="type-selector">
                        <button onclick="selectType(this, 'food')" class="type-btn flex-shrink-0 px-3 py-1.5 rounded-lg text-xs font-bold bg-white text-slate-500 border border-slate-200 transition-all shadow-sm" data-type="food">é£Ÿç‰©</button>
                        <button onclick="selectType(this, 'travel')" class="type-btn flex-shrink-0 px-3 py-1.5 rounded-lg text-xs font-bold bg-white text-slate-500 border border-slate-200 transition-all shadow-sm" data-type="travel">æ™¯é»</button>
                        <button onclick="selectType(this, 'art')" class="type-btn flex-shrink-0 px-3 py-1.5 rounded-lg text-xs font-bold bg-white text-slate-500 border border-slate-200 transition-all shadow-sm" data-type="art">è—æ–‡</button>
                        <button onclick="selectType(this, 'bar')" class="type-btn flex-shrink-0 px-3 py-1.5 rounded-lg text-xs font-bold bg-white text-slate-500 border border-slate-200 transition-all shadow-sm" data-type="bar">é…’å§</button>
                    </div>
                </div>
            </div>

            <!-- åº•éƒ¨æŒ‰éˆ• -->
            <div class="p-4 bg-white border-t border-slate-100 flex justify-end gap-3">
                <button onclick="closeModal()" class="px-4 py-2 text-sm text-slate-500 font-medium hover:text-slate-700 hover:bg-slate-50 rounded-lg transition-colors">å–æ¶ˆ</button>
                <button onclick="saveNewItem()" class="px-6 py-2 text-sm bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition-transform active:scale-95">å„²å­˜è¡Œç¨‹</button>
            </div>
        </div>
    </div>

    <script>
        // --- è¼”åŠ©åŠŸèƒ½ï¼šç”¢ç”Ÿé è¨­å°é¢åœ– ---
        // é€™è£¡æœƒç”¢ç”Ÿé¡è‰²æ–¹å¡Šåœ–ï¼Œå¦‚æœæ‚¨åœ¨æ–°å¢æ™‚è²¼ä¸ŠçœŸå¯¦åœ–ç‰‡ç¶²å€ï¼Œé€™è£¡å°±ä¸æœƒè¢«ä½¿ç”¨
        function getPlaceholder(text, type) {
            let bg = 'cbd5e1'; // gray
            let fg = '475569';
            // æ ¹æ“šé¡å‹çµ¦äºˆä¸åŒè‰²ç³»
            if (type === 'food') { bg = 'fdba74'; fg = '9a3412'; } // æ©˜è‰² (é£Ÿç‰©)
            if (type === 'art') { bg = '5eead4'; fg = '134e4a'; } // é’è‰² (è—æ–‡)
            if (type === 'bar') { bg = '6366f1'; fg = 'e0e7ff'; } // ç´«è‰² (é…’å§)
            if (type === 'music') { bg = 'd8b4fe'; fg = '6b21a8'; } // æ·ºç´« (éŸ³æ¨‚)
            if (type === 'travel') { bg = '93c5fd'; fg = '1e40af'; } // è—è‰² (æ™¯é»)
            
            // ä½¿ç”¨ Placehold.co æœå‹™ç”¢ç”Ÿåœ–ç‰‡
            return `https://placehold.co/600x300/${bg}/${fg}?text=${encodeURIComponent(text)}`;
        }

        // --- é è¨­è¡Œç¨‹è³‡æ–™ ---
        const defaultSchedule = {
            '12/19': [
                { id: '1-1', time: '14:00', title: 'æŠµé”é«˜é›„', location: 'å·¦ç‡Ÿ/é«˜é›„è»Šç«™', type: 'travel', icon: 'ph-train', note: 'å‰å¾€èœœæ¡ƒå®¶æ”¾è¡Œæ' },
                { id: '1-2', time: '16:00', title: 'å…§æƒŸè—è¡“ä¸­å¿ƒ', location: 'é¼“å±±å€é¦¬å¡é“è·¯329è™Ÿ', type: 'art', icon: 'ph-camera', note: 'ç´”ç™½å»ºç¯‰å¥½æ‹ï¼Œå¯é€›å±•æˆ–çœ‹é›»å½±' },
                { id: '1-3', time: '18:00', title: 'DDC é¤é…’é¤¨', location: 'é¼“å±±å€æ˜Œç››è·¯302è™Ÿ', type: 'food', icon: 'ph-fork-knife', note: 'ğŸ”¥ å»ºè­°æå‰è¨‚ä½', highlight: true },
                { id: '1-4', time: '20:00', title: 'å—å–ƒå·¥ä½œ', location: 'æ–°èˆˆå€å—è¯è·¯101è™Ÿ', type: 'work', icon: 'ph-briefcase', note: 'å·¥ä½œå…©å°æ™‚ï¼Œè™•ç†å…¬å‹™' },
                { id: '1-5', time: '22:30', title: 'å…­åˆå¤œå¸‚', location: 'å…­åˆäºŒè·¯', type: 'food', icon: 'ph-moon', note: 'å·¥ä½œå¾Œè£œå……èƒ½é‡' },
                { id: '1-6', time: '23:30', title: 'æµªéš› WAVESTELLAR', location: 'å¤§æ¸¯å€‰ä¸ƒåº«', type: 'bar', icon: 'ph-music-notes', note: 'æ¸¯é‚Šå¤œæ™¯èª¿é…’ï¼Œäº«å—æ°›åœ' },
                { id: '1-7', time: 'æ·±å¤œ', title: 'å›èœœæ¡ƒå®¶', location: 'èœœæ¡ƒå®¶', type: 'sleep', icon: 'ph-moon' },
            ],
            '12/20': {
                options: {
                    'A': [
                        { id: '2A-1', time: '13:00', title: 'æ——æ´¥æ¼«éŠ', location: 'æ——æ´¥', type: 'travel', icon: 'ph-sun', note: 'æ­æ¸¡è¼ªã€çœ‹æµ·ã€åƒæµ·é®®' },
                        { id: '2A-2', time: '15:00', title: 'é¹½åŸ•ç¬¬ä¸€å…¬æœ‰å¸‚å ´', location: 'é¹½åŸ•å€', type: 'food', icon: 'ph-fork-knife', note: 'æ–‡é’å°åº—ã€ç”œé»' },
                        { id: '2A-3', time: '16:30', title: 'é§äºŒè—è¡“ç‰¹å€', location: 'é§äºŒ', type: 'art', icon: 'ph-camera', note: 'é€›å¤§ç¾©å€‰åº«ç¾¤' },
                    ],
                    'B': [
                        { id: '2B-1', time: '13:00', title: 'å£½å±±å‹•ç‰©åœ’', location: 'å£½å±±', type: 'travel', icon: 'ph-sun', note: 'çœ‹æ°´è±šã€æ­éŠåœ’å°ç«è»Š' },
                        { id: '2B-2', time: '16:00', title: 'é«˜é›„æµè¡ŒéŸ³æ¨‚ä¸­å¿ƒ', location: 'çœŸæ„›ç¢¼é ­', type: 'art', icon: 'ph-camera', note: 'æµ·éŸ³é¤¨å»ºç¯‰ã€æ¸¯ç£æ•£æ­¥' },
                    ]
                },
                evening: [
                    { id: '2-4', time: '18:00', title: 'è‡ªå¼·å¤œå¸‚æ™šé¤', location: 'è‹“é›…å¸‚å ´/è‡ªå¼·å¤œå¸‚', type: 'food', icon: 'ph-fork-knife', note: 'åœ¨åœ°ç¾é£Ÿå¤šï¼šå—è±é­¯è‚‰é£¯ã€æ°´é¤ƒ' },
                    { id: '2-5', time: '19:30', title: 'ä¸­å¤®å…¬åœ’è½åœ˜', location: 'ä¸­å¤®å…¬åœ’', type: 'music', icon: 'ph-music-notes', note: 'ğŸ„ 2025é«˜é›„è–èª•ç”Ÿæ´»ç¯€', highlight: true },
                    { id: '2-6', time: '22:00', title: 'OFFLINE å–é…’', location: 'æ–°èˆˆå€ç‰ç«¹äºŒè¡—44è™Ÿ', type: 'bar', icon: 'ph-music-notes', note: 'èŒ¶é…’é¤¨ï¼Œæ°£æ°›ä½³' },
                    { id: '2-7', time: 'æ·±å¤œ', title: 'å›èœœæ¡ƒå®¶', location: 'èœœæ¡ƒå®¶', type: 'sleep', icon: 'ph-moon' },
                ]
            },
            '12/21': [
                { id: '3-1', time: '09:00', title: 'æ—©é¤ï¼šèˆˆéš†å±…', location: 'å‰é‡‘å€å…­åˆäºŒè·¯186è™Ÿ', type: 'food', icon: 'ph-fork-knife', note: 'å¿…é»æ¹¯åŒ…ã€ç‡’é¤…æ²¹æ¢' },
                { id: '3-2', time: '11:00', title: 'è‡ªç”±æ´»å‹• / ä¼‘æ¯', location: '-', type: 'rest', icon: 'ph-sun', note: 'å»ºè­°å›é£¯åº—ä¼‘æ¯æˆ–æ‰¾å’–å•¡å»³ï¼Œç‚ºæ™šä¸Šè“„åŠ›' },
                { id: '3-3', time: '19:00', title: 'Doja Cat æ¼”å”±æœƒ', location: 'é«˜é›„å·¨è›‹', type: 'music', icon: 'ph-music-notes', note: 'ğŸ¤ è¨˜å¾—ææ—©å…¥å ´å®‰æª¢', highlight: true },
                { id: '3-4', time: '22:30', title: 'ç‘è±å¤œå¸‚', location: 'è£•èª è·¯/å—å±è·¯', type: 'food', icon: 'ph-moon', note: 'æ¼”å”±æœƒæ•£å ´è¦“é£Ÿ' },
                { id: '3-5', time: 'æ·±å¤œ', title: 'å›æ—…é¤¨ä¼‘æ¯', location: 'æ—…é¤¨', type: 'sleep', icon: 'ph-moon' },
            ],
            '12/22': [
                { id: '4-1', time: '10:00', title: 'å“†å•¦Aå¤¢å±•', location: 'åœ‹ç«‹ç§‘å­¸å·¥è—åšç‰©é¤¨', type: 'art', icon: 'ph-camera', note: 'THE å“†å•¦Aå¤¢å±•ï¼Œé ç•™2-3å°æ™‚', highlight: true },
                { id: '4-2', time: '14:00', title: 'å·¦ç‡Ÿé¾è™å¡”', location: 'è“®æ± æ½­', type: 'travel', icon: 'ph-sun', note: 'é¾å£é€²è™å£å‡ºï¼Œæ¶ˆç½è§£å„' },
                { id: '4-3', time: '16:30', title: 'å‰å¾€è»Šç«™', location: 'å·¦ç‡Ÿé«˜éµ', type: 'travel', icon: 'ph-train', note: 'æº–å‚™è¿”ç¨‹' },
                { id: '4-4', time: '17:00', title: 'å›å°åŒ—', location: 'å°åŒ—', type: 'travel', icon: 'ph-train', note: 'å¹³å®‰è³¦æ­¸' },
            ]
        };

        // --- ç¨‹å¼é‚è¼¯ ---
        let activeTab = '12/19';
        let day2Plan = 'A'; 
        // è®€å–æš«å­˜è³‡æ–™
        let completedItems = new Set(JSON.parse(localStorage.getItem('kaohsiungTripCompleted') || '[]'));
        let customItems = JSON.parse(localStorage.getItem('kaohsiungTripCustomItems') || '{}');
        let selectedType = 'food';

        // æ¸²æŸ“æ—¥æœŸæ¨™ç±¤
        function renderTabs() {
            const tabsContainer = document.getElementById('date-tabs');
            tabsContainer.innerHTML = '';
            
            Object.keys(defaultSchedule).forEach(date => {
                const btn = document.createElement('button');
                const isActive = activeTab === date;
                btn.className = `flex-1 py-3 px-4 text-sm font-medium whitespace-nowrap border-b-4 transition-all duration-200 ${
                    isActive 
                    ? 'border-white text-white font-bold opacity-100' 
                    : 'border-transparent text-indigo-100 hover:text-white opacity-70 hover:opacity-100'
                }`;
                btn.innerText = date;
                btn.onclick = () => { activeTab = date; renderApp(); };
                tabsContainer.appendChild(btn);
            });
        }

        // æ¸²æŸ“é€±å…­çš„ AB æ–¹æ¡ˆåˆ‡æ›å™¨
        function renderDay2Toggle() {
            const toggleContainer = document.getElementById('day2-toggle');
            const btnA = document.getElementById('btn-plan-a');
            const btnB = document.getElementById('btn-plan-b');

            if (activeTab === '12/20') {
                toggleContainer.classList.remove('hidden');
                if (day2Plan === 'A') {
                    btnA.className = 'flex-1 py-2 px-3 rounded-lg text-sm font-bold bg-indigo-100 text-indigo-700 shadow-sm transition-all';
                    btnB.className = 'flex-1 py-2 px-3 rounded-lg text-sm font-bold text-slate-400 hover:text-slate-600 transition-all';
                } else {
                    btnA.className = 'flex-1 py-2 px-3 rounded-lg text-sm font-bold text-slate-400 hover:text-slate-600 transition-all';
                    btnB.className = 'flex-1 py-2 px-3 rounded-lg text-sm font-bold bg-teal-100 text-teal-700 shadow-sm transition-all';
                }
            } else {
                toggleContainer.classList.add('hidden');
            }
        }

        // å–å¾—ç•¶å‰è¡Œç¨‹åˆ—è¡¨ (åŒ…å«è‡ªè¨‚)
        function getDayList() {
            let currentDayItems = [];
            if (activeTab === '12/20') {
                currentDayItems = [...defaultSchedule['12/20'].options[day2Plan], ...defaultSchedule['12/20'].evening];
            } else {
                currentDayItems = [...defaultSchedule[activeTab]];
            }
            if (customItems[activeTab]) {
                currentDayItems = [...currentDayItems, ...customItems[activeTab]];
            }
            return currentDayItems.sort((a, b) => a.time.localeCompare(b.time));
        }

        function toggleComplete(id) {
            if (completedItems.has(id)) { completedItems.delete(id); } 
            else { completedItems.add(id); }
            localStorage.setItem('kaohsiungTripCompleted', JSON.stringify([...completedItems]));
            renderTimeline();
        }

        function openMap(location) {
            window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location + ' é«˜é›„')}`, '_blank');
        }

        function setDay2Plan(plan) { day2Plan = plan; renderApp(); }

        // --- æ ¸å¿ƒï¼šæ¸²æŸ“åœ–æ–‡å¡ç‰‡ ---
        function renderTimeline() {
            const listContainer = document.getElementById('timeline-list');
            listContainer.innerHTML = '';
            const items = getDayList();

            items.forEach((item, index) => {
                const isCompleted = completedItems.has(item.id);
                
                // å»ºç«‹å¡ç‰‡å¤–æ¡†
                const card = document.createElement('div');
                card.className = `group bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden card-hover transition-all duration-300 relative ${isCompleted ? 'opacity-60 grayscale' : ''}`;

                // æ±ºå®šåœ–ç‰‡ç¶²å€ (è‡ªè¨‚å„ªå…ˆ > é è¨­)
                const imageUrl = item.image || getPlaceholder(item.title, item.type);
                
                // åœ–ç‰‡å€å¡Š
                const imgContainer = document.createElement('div');
                imgContainer.className = 'h-36 w-full bg-slate-200 overflow-hidden relative';
                imgContainer.innerHTML = `
                    <img src="${imageUrl}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" alt="${item.title}" onerror="this.src='https://placehold.co/600x300/e2e8f0/64748b?text=Image'">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent"></div>
                    <div class="absolute bottom-3 left-4 text-white w-full pr-4 flex justify-between items-end">
                        <div class="flex items-center gap-2">
                            <span class="bg-white/20 backdrop-blur-md px-2 py-1 rounded-md text-sm font-bold border border-white/30 tracking-wide">
                                ${item.time}
                            </span>
                             ${item.highlight ? '<span class="bg-yellow-500 text-white px-2 py-1 rounded-md text-[10px] font-bold shadow-sm flex items-center gap-1"><i class="ph-fill ph-star"></i> é‡é»</span>' : ''}
                             ${item.isCustom ? '<span class="bg-indigo-500 text-white px-2 py-1 rounded-md text-[10px] font-bold shadow-sm">è‡ªè¨‚</span>' : ''}
                        </div>
                    </div>
                `;

                // å…§å®¹å€å¡Š
                const content = document.createElement('div');
                content.className = 'p-4';
                
                // æ¨™é¡Œèˆ‡æ‰“å‹¾
                content.innerHTML += `
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-bold text-lg text-slate-800 leading-tight ${isCompleted ? 'line-through decoration-2 decoration-slate-300' : ''}">
                            ${item.title}
                        </h3>
                        <div class="flex gap-2">
                             <button onclick="toggleComplete('${item.id}')" class="w-8 h-8 rounded-full flex items-center justify-center transition-all ${isCompleted ? 'bg-green-100 text-green-600 scale-110' : 'bg-slate-50 text-slate-300 hover:bg-indigo-50 hover:text-indigo-400'}">
                                <i class="${isCompleted ? 'ph-fill ph-check-circle' : 'ph ph-circle'} text-xl"></i>
                            </button>
                        </div>
                    </div>
                `;

                // åœ°é»æŒ‰éˆ•
                if (item.location && item.location !== '-') {
                    content.innerHTML += `
                        <button onclick="openMap('${item.location}')" class="flex items-center gap-1.5 text-xs text-slate-500 mb-3 hover:text-blue-600 transition-colors w-full text-left group/loc">
                            <i class="ph-fill ph-map-pin text-indigo-400 group-hover/loc:scale-110 transition-transform"></i>
                            <span class="truncate border-b border-transparent group-hover/loc:border-blue-200">${item.location}</span>
                            <i class="ph-bold ph-arrow-square-out text-slate-300 ml-auto group-hover/loc:text-blue-400"></i>
                        </button>
                    `;
                }

                // å‚™è¨»
                if (item.note) {
                    content.innerHTML += `
                        <div class="bg-slate-50 p-3 rounded-xl text-sm text-slate-600 flex gap-2 items-start leading-relaxed border border-slate-100">
                            <i class="ph-fill ph-info text-indigo-400 mt-0.5 flex-shrink-0"></i>
                            <span>${item.note}</span>
                        </div>
                    `;
                }

                card.appendChild(imgContainer);
                card.appendChild(content);
                listContainer.appendChild(card);
            });
        }

        // --- åŠŸèƒ½ï¼šé–‹é—œ Modal ---
        function openModal() {
            const modal = document.getElementById('add-modal');
            const content = document.getElementById('modal-content');
            document.getElementById('input-date').value = activeTab;
            
            modal.classList.remove('pointer-events-none', 'opacity-0');
            setTimeout(() => {
                content.classList.remove('scale-95', 'opacity-0');
                content.classList.add('scale-100', 'opacity-100');
            }, 10);
            selectType(document.querySelector('[data-type="food"]'), 'food');
        }

        function closeModal() {
            const modal = document.getElementById('add-modal');
            const content = document.getElementById('modal-content');
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            setTimeout(() => { modal.classList.add('pointer-events-none', 'opacity-0'); }, 300);
            
            // æ¸…ç©ºè¼¸å…¥æ¡†
            ['input-title', 'input-location', 'input-note', 'input-time', 'input-image'].forEach(id => document.getElementById(id).value = '');
        }

        // --- åŠŸèƒ½ï¼šé¸æ“‡é¡å‹ ---
        function selectType(btn, type) {
            selectedType = type;
            document.querySelectorAll('#type-selector .type-btn').forEach(b => {
                b.className = 'type-btn flex-shrink-0 px-3 py-1.5 rounded-lg text-xs font-bold bg-white text-slate-500 border border-slate-200 transition-all shadow-sm';
            });
            let colorClass = 'bg-slate-100 text-slate-800 ring-1 ring-slate-300';
            if(type === 'food') colorClass = 'bg-orange-100 text-orange-700 ring-1 ring-orange-300 border-orange-200';
            if(type === 'travel') colorClass = 'bg-blue-100 text-blue-700 ring-1 ring-blue-300 border-blue-200';
            if(type === 'art') colorClass = 'bg-teal-100 text-teal-700 ring-1 ring-teal-300 border-teal-200';
            if(type === 'bar') colorClass = 'bg-indigo-100 text-indigo-700 ring-1 ring-indigo-300 border-indigo-200';
            btn.className = `type-btn flex-shrink-0 px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${colorClass} scale-105`;
        }

        // --- åŠŸèƒ½ï¼šGPS å®šä½ ---
        function getCurrentLocation() {
            if (!navigator.geolocation) { alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å®šä½åŠŸèƒ½'); return; }
            const btn = document.querySelector('button[onclick="getCurrentLocation()"]');
            const icon = btn.querySelector('i');
            const originalIconClass = icon.className;
            
            icon.className = 'ph ph-spinner animate-spin text-lg'; // è½‰åœˆåœˆç‰¹æ•ˆ
            
            navigator.geolocation.getCurrentPosition(
                (p) => {
                    // æ ¼å¼åŒ–åº§æ¨™
                    document.getElementById('input-location').value = `${p.coords.latitude.toFixed(6)}, ${p.coords.longitude.toFixed(6)}`;
                    icon.className = 'ph-fill ph-check text-lg text-green-600';
                    setTimeout(() => icon.className = originalIconClass, 2000);
                },
                (e) => { 
                    alert('ç„¡æ³•å–å¾—ä½ç½®ï¼Œè«‹ç¢ºèªæ˜¯å¦æœ‰é–‹å•Ÿ GPS æ¬Šé™'); 
                    icon.className = originalIconClass; 
                }
            );
        }

        // --- åŠŸèƒ½ï¼šå„²å­˜æ–°è¡Œç¨‹ ---
        function saveNewItem() {
            const date = document.getElementById('input-date').value;
            const time = document.getElementById('input-time').value;
            const title = document.getElementById('input-title').value;
            const location = document.getElementById('input-location').value;
            const note = document.getElementById('input-note').value;
            const image = document.getElementById('input-image').value;

            if (!time || !title) { alert('è«‹è‡³å°‘å¡«å¯«æ™‚é–“å’Œæ¨™é¡Œï¼'); return; }

            const newItem = {
                id: 'custom-' + Date.now(),
                time, title, location: location || '-', type: selectedType,
                image: image || '',
                note, isCustom: true
            };

            if (!customItems[date]) customItems[date] = [];
            customItems[date].push(newItem);
            localStorage.setItem('kaohsiungTripCustomItems', JSON.stringify(customItems));
            
            closeModal();
            if (activeTab !== date) activeTab = date;
            renderApp();
        }

        // --- åŠŸèƒ½ï¼šæ¸…é™¤è‡ªè¨‚è³‡æ–™ ---
        function clearCustomData() {
            if(confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ‚¨æ‰‹å‹•æ–°å¢çš„è¡Œç¨‹å—ï¼Ÿ(é è¨­è¡Œç¨‹æœƒä¿ç•™)')) {
                localStorage.removeItem('kaohsiungTripCustomItems');
                customItems = {};
                renderApp();
            }
        }

        function renderApp() {
            renderTabs(); renderDay2Toggle(); renderTimeline();
            const footerMsg = document.getElementById('footer-msg');
            footerMsg.innerText = activeTab === '12/22' ? 'æ—…ç¨‹çµæŸï¼ŒæœŸå¾…ä¸‹æ¬¡ç›¸è¦‹ï¼' : 'ä»Šå¤©çš„è¡Œç¨‹çµæŸäº†ï¼Œæ™šå®‰ï¼';
        }

        // å•Ÿå‹• App
        renderApp();
    </script>
</body>
</html>
